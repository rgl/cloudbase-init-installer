name: CI
on: [push]
jobs:
  build:
    runs-on: windows-2019
    steps:
    - uses: actions/checkout@v1
    - name: Dump Environment
      shell: powershell
      run: |
        $FormatEnumerationLimit = -1
        function Write-Title($title) {
          Write-Output "`n#`n# $title`n#"
        }
        Write-Title "whoami"
        C:/Windows/System32/whoami /all
        Write-Title "Windows version"
        cmd /c ver
        Write-Title "Working Directory"
        Get-Location
        Write-Title "Environment Variables"
        dir env: `
          | Format-Table -AutoSize `
          | Out-String -Stream -Width ([int]::MaxValue) `
          | ForEach-Object {$_.TrimEnd()}
        Write-Title "PATH Environment Variable"
        $env:PATH -split ';' `
          | Format-Table -AutoSize `
          | Out-String -Stream -Width ([int]::MaxValue) `
          | ForEach-Object {$_.TrimEnd()}
        Write-Title "TimeZone"
        Get-TimeZone
        Write-Title "installed chocolatey packages"
        choco list -l
        Write-Title "default dotnet msbuild version"
        dotnet msbuild -version
    - name: Build CloudbaseInitSetup
      shell: powershell
      run: dotnet msbuild -m -p:Configuration=Release CloudbaseInitSetup.sln
